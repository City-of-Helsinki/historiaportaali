((o,e,n)=>{e.behaviors.mapControls={attach:function(e,n){let t=this;o(document).on("leaflet.map",(function(o,e,n,a){t.bindEraControls(n),t.bindZoomControls(n),t.bindLocateControl(n)}))},bindEraControls:function(e){let n=this,t=o(".map-controls__map-era .map-controls__map-era-item");t.on("click",(function(a){let i=o(a.target).data("map-era");mapApi=o(a.target).data("map-api"),mapWMSTitle=o(a.target).data("map-wms-title"),n.loadEraLayer(e,i,mapApi,mapWMSTitle),t.removeClass("active"),o(a.target).addClass("active")}))},loadEraLayer:function(o,e,n,t){let a=this,i=a.getMapApiUrl(n);if(t&&"present"!==e){a.showLoadingSpinner();let e=L.tileLayer.wms(i,{layers:t,format:"image/png",transparent:!0});e.addTo(o),e.on("load",(function(n){a.removeOtherMapLayers(o,e),a.hideLoadingSpinner()}))}"present"==e&&a.removeOtherMapLayers(o,null)},removeOtherMapLayers:function(o,e){let n,t=Object.entries(o._layers).filter((([o,e])=>e.wmsParams?.layers));n=e?t.filter((([o,n])=>n.wmsParams.layers!==e.wmsParams.layers)):t,n.length&&n.forEach((o=>o[1].remove()))},getMapApiUrl:function(o){switch(o){case"kartta_hel_fi":return"https://kartta.hel.fi/ws/geoserver/avoindata/wms";case"geoserver_hel_fi":return"https://geoserver.hel.fi/geoserver/ows";default:return""}},showLoadingSpinner:function(){o("#map-loading-overlay").fadeIn(150)},hideLoadingSpinner:function(){o("#map-loading-overlay").fadeOut(150)},bindZoomControls:function(e){let n=o(".map-controls__control-button#zoom-in-btn"),t=o(".map-controls__control-button#zoom-out-btn");n.on("click",(function(){e.zoomIn()})),t.on("click",(function(){e.zoomOut()}))},bindLocateControl:function(e){let n=this;o(".map-controls__control-button#locate-btn").on("click",(function(){navigator.geolocation?(n.showLoadingSpinner(),navigator.geolocation.getCurrentPosition((o=>{n.hideLoadingSpinner();const t=o.coords.latitude,a=o.coords.longitude;e.panTo([t,a]),e.setZoom(15)}),(o=>{1===o.code&&n.showGeolocationDeniedBox(),n.hideLoadingSpinner()}))):console.log("Geolocation is not supported by your browser")}))},showGeolocationDeniedBox:function(){let n=e.t("Location data blocked",{},{context:"Map selectors"}),t=e.t("Unfortunately, we are unable to show places on the map based on your location until you agree to use your location.",{},{context:"Map selectors"}),a=e.t("Close",{},{context:"Map selectors"});o(".leaflet-container").prepend(`\n        <div id="geolocation-denied-overlay" style="display:none;">\n          <div class="info-box">\n            <div class="info-header">\n              <span class="info-icon"></span>\n              <h3>${n}</h3>\n              <div class="close-btn" role="button">${a}</div>\n            </div>\n            <p>${t}</p>\n          </div>\n        </div>\n      `),o("#geolocation-denied-overlay").fadeIn(150),o("#geolocation-denied-overlay .close-btn").on("click",(function(){o("#geolocation-denied-overlay").fadeOut(150)}))}}})(jQuery,Drupal,drupalSettings);