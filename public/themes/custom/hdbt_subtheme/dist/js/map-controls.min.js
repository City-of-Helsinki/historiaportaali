!function(){function o(o,e){return function(o){if(Array.isArray(o))return o}(o)||function(o,n){var e=null==o?null:"undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(null==e)return;var t,r,a=[],i=!0,l=!1;try{for(e=e.call(o);!(i=(t=e.next()).done)&&(a.push(t.value),!n||a.length!==n);i=!0);}catch(o){l=!0,r=o}finally{try{i||null==e.return||e.return()}finally{if(l)throw r}}return a}(o,e)||function(o,e){if(!o)return;if("string"==typeof o)return n(o,e);var t=Object.prototype.toString.call(o).slice(8,-1);"Object"===t&&o.constructor&&(t=o.constructor.name);if("Map"===t||"Set"===t)return Array.from(o);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return n(o,e)}(o,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(o,n){(null==n||n>o.length)&&(n=o.length);for(var e=0,t=new Array(n);e<n;e++)t[e]=o[e];return t}!function(n,e,t){e.behaviors.mapControls={attach:function(o,e){var t=this;n(document).on("leaflet.map",(function(o,n,e,r){t.bindEraControls(e),t.bindZoomControls(e),t.bindLocateControl(e)}))},bindEraControls:function(o){var e=this,t=n(".map-controls__map-era .map-controls__map-era-item");t.on("click",(function(r){var a=n(r.target).data("map-era");mapApi=n(r.target).data("map-api"),mapWMSTitle=n(r.target).data("map-wms-title"),e.loadEraLayer(o,a,mapApi,mapWMSTitle),t.removeClass("active"),n(r.target).addClass("active")}))},loadEraLayer:function(o,n,e,t){var r=this,a=r.getMapApiUrl(e);if(t&&"present"!==n){r.showLoadingSpinner();var i=L.tileLayer.wms(a,{layers:t,format:"image/png",transparent:!0});i.addTo(o),i.on("load",(function(n){r.removeOtherMapLayers(o,i),r.hideLoadingSpinner()}))}"present"==n&&r.removeOtherMapLayers(o,null)},removeOtherMapLayers:function(n,e){var t,r=Object.entries(n._layers).filter((function(n){var e,t=o(n,2);t[0];return null===(e=t[1].wmsParams)||void 0===e?void 0:e.layers}));(t=e?r.filter((function(n){var t=o(n,2);t[0];return t[1].wmsParams.layers!==e.wmsParams.layers})):r).length&&t.forEach((function(o){return o[1].remove()}))},getMapApiUrl:function(o){switch(o){case"kartta_hel_fi":return"https://kartta.hel.fi/ws/geoserver/avoindata/wms";case"geoserver_hel_fi":return"https://geoserver.hel.fi/geoserver/ows";default:return""}},showLoadingSpinner:function(){n("#map-loading-overlay").fadeIn(150)},hideLoadingSpinner:function(){n("#map-loading-overlay").fadeOut(150)},bindZoomControls:function(o){var e=n(".map-controls__control-button#zoom-in-btn"),t=n(".map-controls__control-button#zoom-out-btn");e.on("click",(function(){o.zoomIn()})),t.on("click",(function(){o.zoomOut()}))},bindLocateControl:function(o){var e=this;n(".map-controls__control-button#locate-btn").on("click",(function(){navigator.geolocation?(e.showLoadingSpinner(),navigator.geolocation.getCurrentPosition((function(n){e.hideLoadingSpinner();var t=n.coords.latitude,r=n.coords.longitude;e.addUserLocationMarker(t,r,o),o.panTo([t,r]),o.setZoom(15)}),(function(o){1===o.code&&e.showGeolocationDeniedBox(),e.hideLoadingSpinner()}))):console.log("Geolocation is not supported by your browser")}))},addUserLocationMarker:function(o,n,e){var t=new L.LatLng(o,n),r=L.icon({iconSize:["36","36"],iconUrl:"/themes/custom/hdbt_subtheme/src/icons/user.svg"});L.marker(t,{icon:r}).addTo(e)},showGeolocationDeniedBox:function(){var o=this,t=e.t("Location data blocked",{},{context:"Map selectors"}),r=e.t("Unfortunately, we are unable to show places on the map based on your location until you agree to use your location.",{},{context:"Map selectors"}),a=e.t("Close",{},{context:"Map selectors"});n(".leaflet-container").prepend('\n        <div id="geolocation-denied-overlay" style="display:none;">\n          <div class="info-box">\n            <div class="info-header">\n              <span class="info-icon"></span>\n              <h3>'.concat(t,'</h3>\n              <div class="close-btn" role="button">').concat(a,"</div>\n            </div>\n            <p>").concat(r,"</p>\n          </div>\n        </div>\n      ")),n("#geolocation-denied-overlay").fadeIn(150),n("#geolocation-denied-overlay .close-btn").on("click",(function(){o.hideGeoloactionDeniedBox()})),n(document).keyup((function(n){27===n.keyCode&&o.hideGeoloactionDeniedBox()}))},hideGeoloactionDeniedBox:function(){n("#geolocation-denied-overlay").fadeOut(150)}}}(jQuery,Drupal,drupalSettings)}();