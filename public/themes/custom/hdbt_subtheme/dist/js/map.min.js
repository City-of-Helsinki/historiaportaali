(()=>{var e=Object.defineProperty;var t=(t,n)=>e(t,"name",{value:n,configurable:true});((e,Drupal,n)=>{let o;let r;const{behaviors:i}=Drupal;i.map={attach(t){if(n("map","body").length){e(document).on("leafletMapInit",(t,n,i,a)=>{if(a.startsWith("leaflet-map-view-combined-map-block")){o=i;r=e(`#${a}`);const t=this.getUrlParameter("id");this.bindPopupPositioning();if(t){setTimeout(()=>{this.openPopupByNid(t)},300)}}})}this.bindFilterToggle(t)},bindFilterToggle(t){const o=e(n("button",".exposed-filters .toggle-filters-btn",t));const r=e(".exposed-filters .exposed-filters__container",t);o.on("click",()=>{r.slideToggle(150);if(r.is(":visible")&&o.find("span.hds-icon").hasClass("hds-icon--angle-down")){o.find("span.hds-icon").removeClass("hds-icon--angle-down");o.find("span.hds-icon").addClass("hds-icon--angle-up")}else{o.find("span.hds-icon").removeClass("hds-icon--angle-up");o.find("span.hds-icon").addClass("hds-icon--angle-down")}})},openPopupByNid(e){if(!o||!r||!e){return}const t=r.data("leaflet");if(!t?.markers){return}const n=String(e);let i=t.markers[n];if(!i){const e=Object.keys(t.markers).find(e=>e.startsWith(`${n}-`));if(e){i=t.markers[e]}}if(!i){console.warn("Map: No marker found ID",n);console.info("Available marker IDs:",Object.keys(t.markers).map(e=>e.replace("-0","")));return}let a=false;o.eachLayer(e=>{if(e._group&&typeof e.getAllChildMarkers==="function"){if(e.getAllChildMarkers().includes(i)){a=true}}});this.zoomToLayer(i,a)},zoomToLayer(e,n=false){if(!e||!o){return false}if(n&&e.__parent?._group){e.__parent._group.zoomToShowLayer(e,()=>{e.openPopup()});return true}const r=t(()=>{e.openPopup();o.off("moveend",r)},"openPopupHandler");o.on("moveend",r);o.setView(e._latlng,15);return true},bindPopupPositioning(){o.on("popupopen",e=>{const t=o.project(e.target._popup._latlng);t.y-=e.target._popup._container.clientHeight;o.panTo(o.unproject(t),{animate:true});this.updateUrlWithEntityId(e.target._popup._source)});o.on("popupclose",()=>{this.clearUrlEntityId()})},updateUrlWithEntityId(e){if(!e||!r){return}const t=r.data("leaflet");if(!t?.markers){return}const n=Object.keys(t.markers).find(n=>t.markers[n]===e);if(n){const e=n.replace("-0","");const t=new URL(window.location);t.searchParams.set("id",e);window.history.replaceState({},"",t)}},clearUrlEntityId(){const e=new URL(window.location);e.searchParams.delete("id");window.history.replaceState({},"",e)},getUrlParameter(e){const t=window.location.search.substring(1);const n=t.split("&");let o;let r;for(r=0;r<n.length;r+=1){o=n[r].split("=");if(o[0]===e){return typeof o[1]==="undefined"?true:decodeURIComponent(o[1])}}return false}}})(jQuery,Drupal,once)})();