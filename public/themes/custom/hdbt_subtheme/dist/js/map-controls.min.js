!function(){function o(o,t){return function(o){if(Array.isArray(o))return o}(o)||function(o,n){var t=null==o?null:"undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(null==t)return;var e,r,a=[],i=!0,l=!1;try{for(t=t.call(o);!(i=(e=t.next()).done)&&(a.push(e.value),!n||a.length!==n);i=!0);}catch(o){l=!0,r=o}finally{try{i||null==t.return||t.return()}finally{if(l)throw r}}return a}(o,t)||function(o,t){if(!o)return;if("string"==typeof o)return n(o,t);var e=Object.prototype.toString.call(o).slice(8,-1);"Object"===e&&o.constructor&&(e=o.constructor.name);if("Map"===e||"Set"===e)return Array.from(o);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return n(o,t)}(o,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(o,n){(null==n||n>o.length)&&(n=o.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=o[t];return e}!function(n,t,e){t.behaviors.mapControls={attach:function(o,t){var e=this;n(document).on("leaflet.map",(function(o,n,t,r){e.bindEraControls(t),e.bindZoomControls(t),e.bindLocateControl(t),t.removeControl(t.zoomControl)}))},bindEraControls:function(o){var t=this,e=n(".map-controls__map-era .map-controls__map-era-item");e.on("click",(function(r){var a=n(r.target).data("map-era");mapApi=n(r.target).data("map-api"),mapWMSTitle=n(r.target).data("map-wms-title"),t.loadEraLayer(o,a,mapApi,mapWMSTitle),e.removeClass("active"),n(r.target).addClass("active")}))},loadEraLayer:function(o,n,t,e){var r=this,a=r.getMapApiUrl(t);if(e&&"present"!==n){r.showLoadingSpinner();var i=L.tileLayer.wms(a,{layers:e,format:"image/png",transparent:!0});i.addTo(o),i.on("load",(function(n){r.removeOtherMapLayers(o,i),r.hideLoadingSpinner()}))}"present"==n&&r.removeOtherMapLayers(o,null)},removeOtherMapLayers:function(n,t){var e,r=Object.entries(n._layers).filter((function(n){var t,e=o(n,2);e[0];return null===(t=e[1].wmsParams)||void 0===t?void 0:t.layers}));(e=t?r.filter((function(n){var e=o(n,2);e[0];return e[1].wmsParams.layers!==t.wmsParams.layers})):r).length&&e.forEach((function(o){return o[1].remove()}))},getMapApiUrl:function(o){switch(o){case"kartta_hel_fi":return"https://kartta.hel.fi/ws/geoserver/avoindata/wms";case"geoserver_hel_fi":return"https://geoserver.hel.fi/geoserver/ows";default:return""}},showLoadingSpinner:function(){n("#map-loading-overlay").fadeIn(150)},hideLoadingSpinner:function(){n("#map-loading-overlay").fadeOut(150)},bindZoomControls:function(o){var t=n(".map-controls__control-button#zoom-in-btn"),e=n(".map-controls__control-button#zoom-out-btn");t.on("click",(function(){o.zoomIn()})),e.on("click",(function(){o.zoomOut()}))},bindLocateControl:function(o){var t=this;n(".map-controls__control-button#locate-btn").on("click",(function(){navigator.geolocation?(t.showLoadingSpinner(),navigator.geolocation.getCurrentPosition((function(n){t.hideLoadingSpinner();var e=n.coords.latitude,r=n.coords.longitude;t.addUserLocationMarker(e,r,o),o.panTo([e,r]),o.setZoom(15)}),(function(o){1===o.code&&t.showGeolocationDeniedBox(),t.hideLoadingSpinner()}))):console.log("Geolocation is not supported by your browser")}))},addUserLocationMarker:function(o,n,t){var e=new L.LatLng(o,n),r=L.icon({iconSize:["36","36"],iconUrl:"/themes/custom/hdbt_subtheme/src/icons/user.svg"});L.marker(e,{icon:r}).addTo(t)},showGeolocationDeniedBox:function(){var o=t.t("Location data blocked",{},{context:"Map selectors"}),e=t.t("Unfortunately, we are unable to show places on the map based on your location until you agree to use your location.",{},{context:"Map selectors"}),r=t.t("Close",{},{context:"Map selectors"});n(".leaflet-container").prepend('\n        <div id="geolocation-denied-overlay" style="display:none;">\n          <div class="info-box">\n            <div class="info-header">\n              <span class="info-icon"></span>\n              <h3>'.concat(o,'</h3>\n              <div class="close-btn" role="button">').concat(r,"</div>\n            </div>\n            <p>").concat(e,"</p>\n          </div>\n        </div>\n      ")),n("#geolocation-denied-overlay").fadeIn(150),n("#geolocation-denied-overlay .close-btn").on("click",(function(){n("#geolocation-denied-overlay").fadeOut(150)}))}}}(jQuery,Drupal,drupalSettings)}();