!function(){function n(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,o){var e=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null==e)return;var t,a,r=[],i=!0,l=!1;try{for(e=e.call(n);!(i=(t=e.next()).done)&&(r.push(t.value),!o||r.length!==o);i=!0);}catch(n){l=!0,a=n}finally{try{i||null==e.return||e.return()}finally{if(l)throw a}}return r}(n,e)||function(n,e){if(!n)return;if("string"==typeof n)return o(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);"Object"===t&&n.constructor&&(t=n.constructor.name);if("Map"===t||"Set"===t)return Array.from(n);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return o(n,e)}(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(n,o){(null==o||o>n.length)&&(o=n.length);for(var e=0,t=new Array(o);e<o;e++)t[e]=n[e];return t}!function(o,e,t){e.behaviors.mapControls={attach:function(n,e){var t=this;L.Map.addInitHook((function(){var n;"comparison-map"==(null===(n=this.options)||void 0===n?void 0:n.mapName)?t.bindLayerControls(this,"comparison-map"):(t.bindLayerControls(this,"main-map"),t.bindZoomControls(this),t.bindLocateControl(this),this.removeControl(this.zoomControl)),o(".map-controls__map-layer").select2({minimumResultsForSearch:1/0,placeholder:{id:"default",text:"Select an option"},allowClear:!0}).on("select2:clear",(function(n){o(this).on("select2:opening.cancelOpen",(function(n){n.preventDefault(),o(this).off("select2:opening.cancelOpen")}))})),this.on("unload",(function(){var n;"comparison-map"==(null===(n=this.options)||void 0===n?void 0:n.mapName)?t.unBindLayerControls("comparison-map"):t.unBindLayerControls("main-map")}))}))},bindLayerControls:function(n,e){var t=this,a=o(".map-controls__map-layer.".concat(e));a.change((function(e){var r=o(e.target).find(":selected").not("[map-layer-title='default']").data("map-layer-title");mapApiEndpoints=o(e.target).find(":selected").not("[map-layer-title='default']").data("map-api-endpoints"),t.handleLayerSelection(n,r,mapApiEndpoints),a.not(e.target).val("").trigger("change.select2"),alert("pillu")}))},unBindLayerControls:function(n){o(".map-controls__map-layer.".concat(n)).off("click")},toggleLayerSelectorVisibility:function(n){var e=o(".map-controls__map-layer.".concat(n));e.is(".open")?e.removeClass("open"):e.addClass("open")},handleLayerSelection:function(n,o,e){var t=this;"present"!=o?e&&e.forEach((function(e){t.addMapLayer(n,e,o)})):t.removeOtherMapLayers(n,null)},addMapLayer:function(n,o,e){var t=this,a=t.getMapApiUrl(o.map_api);t.showLoadingSpinner();var r=L.tileLayer.wms(a,{layers:o.wms_title,format:"image/png",transparent:!0,className:e});r.addTo(n),r.on("load",(function(o){t.removeOtherMapLayers(n,e),t.hideLoadingSpinner()}))},removeOtherMapLayers:function(o,e){var t,a=Object.entries(o._layers).filter((function(o){var e,t=n(o,2);t[0];return null===(e=t[1].wmsParams)||void 0===e?void 0:e.layers}));(t=e?a.filter((function(o){var t=n(o,2);t[0];return t[1].options.className!==e})):a).length&&t.forEach((function(n){return n[1].remove()}))},getMapApiUrl:function(n){switch(n){case"kartta_hel_fi":return"https://kartta.hel.fi/ws/geoserver/avoindata/wms";case"geoserver_hel_fi":return"https://geoserver.hel.fi/geoserver/ows";default:return""}},showLoadingSpinner:function(){o("#map-loading-overlay").fadeIn(150)},hideLoadingSpinner:function(){o("#map-loading-overlay").fadeOut(150)},bindZoomControls:function(n){var e=o(".map-controls__control-button#zoom-in-btn"),t=o(".map-controls__control-button#zoom-out-btn");e.on("click",(function(){n.zoomIn()})),t.on("click",(function(){n.zoomOut()}))},bindLocateControl:function(n){var e=this;o(".map-controls__control-button#locate-btn").on("click",(function(){navigator.geolocation?(e.showLoadingSpinner(),navigator.geolocation.getCurrentPosition((function(o){e.hideLoadingSpinner();var t=o.coords.latitude,a=o.coords.longitude;e.addUserLocationMarker(t,a,n),n.panTo([t,a]),n.setZoom(15)}),(function(n){1===n.code&&e.showGeolocationDeniedBox(),e.hideLoadingSpinner()}))):console.log("Geolocation is not supported by your browser")}))},addUserLocationMarker:function(n,o,e){var t=new L.LatLng(n,o),a=L.icon({iconSize:["36","36"],iconUrl:"/themes/custom/hdbt_subtheme/src/icons/user.svg"});L.marker(t,{icon:a}).addTo(e)},showGeolocationDeniedBox:function(){var n=this,t=e.t("Location data blocked",{},{context:"Map selectors"}),a=e.t("Unfortunately, we are unable to show places on the map based on your location until you agree to use your location.",{},{context:"Map selectors"}),r=e.t("Close",{},{context:"Map selectors"});o(".leaflet-container").prepend('\n        <div id="geolocation-denied-overlay" style="display:none;">\n          <div class="info-box">\n            <div class="info-header">\n              <span class="info-icon"></span>\n              <h3>'.concat(t,'</h3>\n              <div class="close-btn" role="button">').concat(r,"</div>\n            </div>\n            <p>").concat(a,"</p>\n          </div>\n        </div>\n      ")),o("#geolocation-denied-overlay").fadeIn(150),o("#geolocation-denied-overlay .close-btn").on("click",(function(){n.hideGeoloactionDeniedBox()})),o(document).keyup((function(o){27===o.keyCode&&n.hideGeoloactionDeniedBox()}))},hideGeoloactionDeniedBox:function(){o("#geolocation-denied-overlay").fadeOut(150)}}}(jQuery,Drupal,drupalSettings)}();