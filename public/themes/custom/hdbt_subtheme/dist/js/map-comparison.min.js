(()=>{((e,Drupal,drupalSettings,n)=>{let a;let t;const o="comparison-map-container";const s=".views--combined-map";const{behaviors:r}=Drupal;r.mapComparison={attach(n){e(document).on("leafletMapInit",(e,t,o)=>{a=o;this.bindCompareButton(n)})},bindCompareButton(a){const t=e(s,a);const o=e(n("comparison-button",".map-controls__control #map-comparison-btn",a));o.on("click",()=>{if(!t.is(".comparison-enabled")){this.enableMapComparison()}else{this.disableMapComparison()}})},enableMapComparison(){const n=e(`#${o}`);const t=this.initMap(o);if(!t){console.error("Failed to initialize comparison map");return}const r=e(s);r.addClass("comparison-enabled");n.fadeIn(150);a.invalidateSize();this.attachPopupListeners(o);setTimeout(()=>{const e=this.syncMaps();if(!e){console.error("Failed to sync maps")}},100)},initMap(n){const a=e(`#${n}`);const o=Object.values(drupalSettings.leaflet)[0];if(!o){return false}const s=o.map;s.settings.mapName="comparison-map";if(a.data("leaflet")===void 0){a.data("leaflet",new Drupal.Leaflet(L.DomUtil.get(n),n,s));t=a.data("leaflet").lMap;a.data("leaflet").lMap.zoomControl.remove();if(o.features.length>0){a.data("leaflet").markers={};a.data("leaflet").features={};a.data("leaflet").add_features(o.features,true)}}return true},attachPopupListeners(n){const a=e(`#${n}`);a.data("leaflet").lMap.on("popupopen",n=>{const a=n.popup._contentNode;const t=e("[data-leaflet-ajax-popup]",a);if(t.length){const e=t.data("leaflet-ajax-popup");Drupal.ajax({url:e}).execute().done(()=>{n.popup.setContent(a.innerHTML);n.popup.update();Drupal.attachBehaviors(a,drupalSettings)})}})},disableMapComparison(){const n=e(`#${o}`);const t=e(s);t.removeClass("comparison-enabled");n.fadeOut(150);this.unSyncMaps();a.invalidateSize()},syncMaps(){if(!a||!t){console.warn("Cannot sync maps: one or both maps not initialized");return false}if(typeof a.sync!=="function"||typeof t.sync!=="function"){console.error("Leaflet.Sync plugin not loaded");return false}try{a.sync(t);t.sync(a);return true}catch(e){console.error("Error syncing maps:",e);return false}},unSyncMaps(){if(!a||!t){console.warn("Cannot unsync maps: one or both maps not initialized");return false}if(typeof a.unsync!=="function"||typeof t.unsync!=="function"){console.warn("Leaflet.Sync plugin not loaded or maps not synced");return false}try{a.unsync(t);t.unsync(a);return true}catch(e){console.error("Error unsyncing maps:",e);return false}}}})(jQuery,Drupal,drupalSettings,once)})();