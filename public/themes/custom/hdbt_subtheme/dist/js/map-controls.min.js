!function(){function o(o,e){return function(o){if(Array.isArray(o))return o}(o)||function(o,n){var e=null==o?null:"undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(null!=e){var t,a,r,i,l=[],c=!0,s=!1;try{if(r=(e=e.call(o)).next,0===n){if(Object(e)!==e)return;c=!1}else for(;!(c=(t=r.call(e)).done)&&(l.push(t.value),l.length!==n);c=!0);}catch(o){s=!0,a=o}finally{try{if(!c&&null!=e.return&&(i=e.return(),Object(i)!==i))return}finally{if(s)throw a}}return l}}(o,e)||function(o,e){if(o){if("string"==typeof o)return n(o,e);var t={}.toString.call(o).slice(8,-1);return"Object"===t&&o.constructor&&(t=o.constructor.name),"Map"===t||"Set"===t?Array.from(o):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?n(o,e):void 0}}(o,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(o,n){(null==n||n>o.length)&&(n=o.length);for(var e=0,t=Array(n);e<n;e++)t[e]=o[e];return t}!function(n,e){e.behaviors.mapControls={attach:function(o,e){var t=this;L.Map.addInitHook((function(){var o;"comparison-map"==(null===(o=this.options)||void 0===o?void 0:o.mapName)?t.bindLayerControls(this,"comparison-map"):(t.bindLayerControls(this,"main-map"),t.bindZoomControls(this),t.bindLocateControl(this),this.removeControl(this.zoomControl)),n(".map-controls__map-layer").each((function(){var o=n(this),e=o.attr("aria-label");o.select2({minimumResultsForSearch:1/0,placeholder:function(){return n(this).data("placeholder")},allowClear:!0});var t=o.next(".select2-container").find(".select2-selection__rendered");t.attr({role:"combobox","aria-label":e,"aria-haspopup":"listbox","aria-expanded":"false"}),o.on("select2:open",(function(){t.attr("aria-expanded","true")})).on("select2:close",(function(){t.attr("aria-expanded","false")})),o.on("select2:select",(function(o){var n=o.params.data.text;t.attr("aria-label","".concat(e,": ").concat(n))}))})),n(".map-controls__map-layer").val("default").trigger("change.select2"),this.on("unload",(function(){var o;"comparison-map"==(null===(o=this.options)||void 0===o?void 0:o.mapName)?t.unBindLayerControls("comparison-map"):t.unBindLayerControls("main-map")}))}))},bindLayerControls:function(o,e){var t=this,a=n(".map-controls__map-layer.".concat(e));a.change((function(e){var r=n(e.target).find(":selected").not("[map-layer-title='default']").data("map-layer-title");mapApiEndpoints=n(e.target).find(":selected").not("[map-layer-title='default']").data("map-api-endpoints"),t.handleLayerSelection(o,r,mapApiEndpoints),a.not(e.target).val("default").trigger("change.select2")})),a.on("select2:clear",(function(n){t.removeOtherMapLayers(o,null)}))},unBindLayerControls:function(o){n(".map-controls__map-layer.".concat(o)).off("click")},toggleLayerSelectorVisibility:function(o){var e=n(".map-controls__map-layer.".concat(o));e.is(".open")?e.removeClass("open"):e.addClass("open")},handleLayerSelection:function(o,n,e){var t=this;"present"!=n?e&&e.forEach((function(e){t.addMapLayer(o,e,n)})):t.removeOtherMapLayers(o,null)},addMapLayer:function(o,n,e){var t=this,a=t.getMapApiUrl(n.map_api);t.showLoadingSpinner();var r=L.tileLayer.wms(a,{layers:n.wms_title,format:"image/png",transparent:!0,className:e});r.addTo(o),r.on("load",(function(n){t.removeOtherMapLayers(o,e),t.hideLoadingSpinner()}))},removeOtherMapLayers:function(n,e){var t,a=Object.entries(n._layers).filter((function(n){var e,t=o(n,2);t[0];return null===(e=t[1].wmsParams)||void 0===e?void 0:e.layers}));(t=e?a.filter((function(n){var t=o(n,2);t[0];return t[1].options.className!==e})):a).length&&t.forEach((function(o){return o[1].remove()}))},getMapApiUrl:function(o){switch(o){case"kartta_hel_fi":return"https://kartta.hel.fi/ws/geoserver/avoindata/wms";case"geoserver_hel_fi":return"https://geoserver.hel.fi/geoserver/ows";default:return""}},showLoadingSpinner:function(){n("#map-loading-overlay").fadeIn(150)},hideLoadingSpinner:function(){n("#map-loading-overlay").fadeOut(150)},bindZoomControls:function(o){var e=n(".map-controls__control-button#zoom-in-btn"),t=n(".map-controls__control-button#zoom-out-btn");e.on("click",(function(){o.zoomIn()})),t.on("click",(function(){o.zoomOut()}))},bindLocateControl:function(o){var e=this;n(".map-controls__control-button#locate-btn").on("click",(function(){navigator.geolocation?(e.showLoadingSpinner(),navigator.geolocation.getCurrentPosition((function(n){e.hideLoadingSpinner();var t=n.coords.latitude,a=n.coords.longitude;e.addUserLocationMarker(t,a,o),o.panTo([t,a]),o.setZoom(15)}),(function(o){1===o.code&&e.showGeolocationDeniedBox(),e.hideLoadingSpinner()}))):console.log("Geolocation is not supported by your browser")}))},addUserLocationMarker:function(o,n,e){var t=new L.LatLng(o,n),a=L.icon({iconSize:["36","36"],iconUrl:"/themes/custom/hdbt_subtheme/src/icons/user.svg"});L.marker(t,{icon:a}).addTo(e)},showGeolocationDeniedBox:function(){var o=this,t=e.t("Location data blocked",{},{context:"Map selectors"}),a=e.t("Unfortunately, we are unable to show places on the map based on your location until you agree to use your location.",{},{context:"Map selectors"}),r=e.t("Close",{},{context:"Map selectors"});n(".leaflet-container").prepend('\n        <div id="geolocation-denied-overlay" style="display:none;">\n          <div class="info-box">\n            <div class="info-header">\n              <span class="info-icon"></span>\n              <h3>'.concat(t,'</h3>\n              <div class="close-btn" role="button">').concat(r,"</div>\n            </div>\n            <p>").concat(a,"</p>\n          </div>\n        </div>\n      ")),n("#geolocation-denied-overlay").fadeIn(150),n("#geolocation-denied-overlay .close-btn").on("click",(function(){o.hideGeoloactionDeniedBox()})),n(document).keyup((function(n){27===n.keyCode&&o.hideGeoloactionDeniedBox()}))},hideGeoloactionDeniedBox:function(){n("#geolocation-denied-overlay").fadeOut(150)}}}(jQuery,Drupal,drupalSettings)}();