(()=>{var e=Object.defineProperty;var n=(n,t)=>e(n,"name",{value:t,configurable:true});((e,Drupal,drupalSettings,t)=>{let a;let o;const s="comparison-map-container";const i=".views--combined-map";Drupal.behaviors.mapComparison={attach:n(function(n,t){let o=this;e(document).on("leafletMapInit",function(e,t,s,i){a=s;o.bindCompareButton(n)})},"attach"),bindCompareButton:n(function(n){let a=this;let o=e(i,n);let s=e(t("comparison-button",".map-controls__control #map-comparison-btn",n));s.on("click",function(){if(!o.is(".comparison-enabled")){a.enableMapComparison()}else{a.disableMapComparison()}})},"bindCompareButton"),enableMapComparison:n(function(){let n=this;const t=e(`#${s}`);const o=n.initMap(s);if(!o){console.error("Failed to initialize comparison map");return}let r=e(i);r.addClass("comparison-enabled");t.fadeIn(150);a.invalidateSize();n.attachPopupListeners(s);setTimeout(()=>{const e=n.syncMaps();if(!e){console.error("Failed to sync maps")}},100)},"enableMapComparison"),initMap:n(function(n){let t=e(`#${n}`);const a=Object.values(drupalSettings.leaflet)[0];if(!a){return false}let s=a.map;s.settings.mapName="comparison-map";if(t.data("leaflet")===void 0){t.data("leaflet",new Drupal.Leaflet(L.DomUtil.get(n),n,s));o=t.data("leaflet").lMap;t.data("leaflet").lMap.zoomControl.remove();if(a.features.length>0){t.data("leaflet").markers={};t.data("leaflet").features={};t.data("leaflet").add_features(a.features,true)}}return true},"initMap"),attachPopupListeners:n(function(n){let t=e(`#${n}`);t.data("leaflet").lMap.on("popupopen",function(n){let t=n.popup._contentNode;let a=e("[data-leaflet-ajax-popup]",t);if(a.length){let e=a.data("leaflet-ajax-popup");Drupal.ajax({url:e}).execute().done(function(){n.popup.setContent(t.innerHTML);n.popup.update();Drupal.attachBehaviors(t,drupalSettings)})}})},"attachPopupListeners"),disableMapComparison:n(function(){let n=this;const t=e(`#${s}`);let o=e(i);o.removeClass("comparison-enabled");t.fadeOut(150);n.unSyncMaps();a.invalidateSize()},"disableMapComparison"),syncMaps:n(function(){if(!a||!o){console.warn("Cannot sync maps: one or both maps not initialized");return false}if(typeof a.sync!=="function"||typeof o.sync!=="function"){console.error("Leaflet.Sync plugin not loaded");return false}try{a.sync(o);o.sync(a);return true}catch(e){console.error("Error syncing maps:",e);return false}},"syncMaps"),unSyncMaps:n(function(){if(!a||!o){console.warn("Cannot unsync maps: one or both maps not initialized");return false}if(typeof a.unsync!=="function"||typeof o.unsync!=="function"){console.warn("Leaflet.Sync plugin not loaded or maps not synced");return false}try{a.unsync(o);o.unsync(a);return true}catch(e){console.error("Error unsyncing maps:",e);return false}},"unSyncMaps")}})(jQuery,Drupal,drupalSettings,once)})();