!function(){function n(n,t){return function(n){if(Array.isArray(n))return n}(n)||function(n,o){var t=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null==t)return;var e,r,a=[],i=!0,l=!1;try{for(t=t.call(n);!(i=(e=t.next()).done)&&(a.push(e.value),!o||a.length!==o);i=!0);}catch(n){l=!0,r=n}finally{try{i||null==t.return||t.return()}finally{if(l)throw r}}return a}(n,t)||function(n,t){if(!n)return;if("string"==typeof n)return o(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);"Object"===e&&n.constructor&&(e=n.constructor.name);if("Map"===e||"Set"===e)return Array.from(n);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return o(n,t)}(n,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(n,o){(null==o||o>n.length)&&(o=n.length);for(var t=0,e=new Array(o);t<o;t++)e[t]=n[t];return e}!function(o,t,e){t.behaviors.mapControls={attach:function(n,t){var e=this;o(document).on("leaflet.map",(function(n,o,t,r){e.bindEraControls(t),e.bindZoomControls(t),e.bindLocateControl(t)}))},bindEraControls:function(n){var t=this,e=o(".map-controls__map-era .map-controls__map-era-item");e.on("click",(function(r){var a=o(r.target).data("map-era");mapApi=o(r.target).data("map-api"),mapWMSTitle=o(r.target).data("map-wms-title"),t.loadEraLayer(n,a,mapApi,mapWMSTitle),e.removeClass("active"),o(r.target).addClass("active")}))},loadEraLayer:function(n,o,t,e){var r=this,a=r.getMapApiUrl(t);if(e&&"present"!==o){r.showLoadingSpinner();var i=L.tileLayer.wms(a,{layers:e,format:"image/png",transparent:!0});i.addTo(n),i.on("load",(function(o){r.removeOtherMapLayers(n,i),r.hideLoadingSpinner()}))}"present"==o&&r.removeOtherMapLayers(n,null)},removeOtherMapLayers:function(o,t){var e,r=Object.entries(o._layers).filter((function(o){var t,e=n(o,2);e[0];return null===(t=e[1].wmsParams)||void 0===t?void 0:t.layers}));(e=t?r.filter((function(o){var e=n(o,2);e[0];return e[1].wmsParams.layers!==t.wmsParams.layers})):r).length&&e.forEach((function(n){return n[1].remove()}))},getMapApiUrl:function(n){switch(n){case"kartta_hel_fi":return"https://kartta.hel.fi/ws/geoserver/avoindata/wms";case"geoserver_hel_fi":return"https://geoserver.hel.fi/geoserver/ows";default:return""}},showLoadingSpinner:function(){o("#map-loading-overlay").fadeIn(150)},hideLoadingSpinner:function(){o("#map-loading-overlay").fadeOut(150)},bindZoomControls:function(n){var t=o(".map-controls__control-button#zoom-in-btn"),e=o(".map-controls__control-button#zoom-out-btn");t.on("click",(function(){n.zoomIn()})),e.on("click",(function(){n.zoomOut()}))},bindLocateControl:function(n){var t=this;o(".map-controls__control-button#locate-btn").on("click",(function(){navigator.geolocation?(t.showLoadingSpinner(),navigator.geolocation.getCurrentPosition((function(o){t.hideLoadingSpinner();var e=o.coords.latitude,r=o.coords.longitude;t.addUserLocationMarker(e,r,n),n.panTo([e,r]),n.setZoom(15)}),(function(n){1===n.code&&t.showGeolocationDeniedBox(),t.hideLoadingSpinner()}))):console.log("Geolocation is not supported by your browser")}))},addUserLocationMarker:function(n,o,t){var e=new L.LatLng(n,o),r=L.icon({iconSize:["36","36"],iconUrl:"/themes/custom/hdbt_subtheme/src/icons/user.svg"});L.marker(e,{icon:r}).addTo(t)},showGeolocationDeniedBox:function(){var n=t.t("Location data blocked",{},{context:"Map selectors"}),e=t.t("Unfortunately, we are unable to show places on the map based on your location until you agree to use your location.",{},{context:"Map selectors"}),r=t.t("Close",{},{context:"Map selectors"});o(".leaflet-container").prepend('\n        <div id="geolocation-denied-overlay" style="display:none;">\n          <div class="info-box">\n            <div class="info-header">\n              <span class="info-icon"></span>\n              <h3>'.concat(n,'</h3>\n              <div class="close-btn" role="button">').concat(r,"</div>\n            </div>\n            <p>").concat(e,"</p>\n          </div>\n        </div>\n      ")),o("#geolocation-denied-overlay").fadeIn(150),o("#geolocation-denied-overlay .close-btn").on("click",(function(){o("#geolocation-denied-overlay").fadeOut(150)}))}}}(jQuery,Drupal,drupalSettings)}();