(()=>{((e,Drupal,drupalSettings,a)=>{let n;let t;const o="comparison-map-container";const s=".views--combined-map";const{behaviors:r}=Drupal;r.mapComparison={attach(a){e(document).on("leafletMapInit",(e,t,o)=>{n=o;this.bindCompareButton(a)})},bindCompareButton(n){const t=e(s,n);const o=e(a("comparison-button",".map-controls__control #map-comparison-btn",n));o.on("click",()=>{if(!t.is(".comparison-enabled")){this.enableMapComparison();o.attr("aria-pressed","true")}else{this.disableMapComparison();o.attr("aria-pressed","false")}})},enableMapComparison(){const a=e(`#${o}`);const t=this.initMap(o);if(!t){console.error("Failed to initialize comparison map");return}const r=e(s);r.addClass("comparison-enabled");a.fadeIn(150);n.invalidateSize();this.attachPopupListeners(o);setTimeout(()=>{const e=this.syncMaps();if(!e){console.error("Failed to sync maps")}},100)},initMap(a){const n=e(`#${a}`);const o=Object.values(drupalSettings.leaflet)[0];if(!o){return false}const s=o.map;s.settings.mapName="comparison-map";if(n.data("leaflet")===void 0){n.data("leaflet",new Drupal.Leaflet(L.DomUtil.get(a),a,s));t=n.data("leaflet").lMap;n.data("leaflet").lMap.zoomControl.remove();if(o.features.length>0){n.data("leaflet").markers={};n.data("leaflet").features={};n.data("leaflet").add_features(o.features,true)}}return true},attachPopupListeners(a){const n=e(`#${a}`);n.data("leaflet").lMap.on("popupopen",a=>{const n=a.popup._contentNode;const t=e("[data-leaflet-ajax-popup]",n);if(t.length){const e=t.data("leaflet-ajax-popup");Drupal.ajax({url:e}).execute().done(()=>{a.popup.setContent(n.innerHTML);a.popup.update();Drupal.attachBehaviors(n,drupalSettings)})}})},disableMapComparison(){const a=e(`#${o}`);const t=e(s);t.removeClass("comparison-enabled");a.fadeOut(150);this.unSyncMaps();n.invalidateSize()},syncMaps(){if(!n||!t){console.warn("Cannot sync maps: one or both maps not initialized");return false}if(typeof n.sync!=="function"||typeof t.sync!=="function"){console.error("Leaflet.Sync plugin not loaded");return false}try{n.sync(t);t.sync(n);return true}catch(e){console.error("Error syncing maps:",e);return false}},unSyncMaps(){if(!n||!t){console.warn("Cannot unsync maps: one or both maps not initialized");return false}if(typeof n.unsync!=="function"||typeof t.unsync!=="function"){console.warn("Leaflet.Sync plugin not loaded or maps not synced");return false}try{n.unsync(t);t.unsync(n);return true}catch(e){console.error("Error unsyncing maps:",e);return false}}}})(jQuery,Drupal,drupalSettings,once)})();