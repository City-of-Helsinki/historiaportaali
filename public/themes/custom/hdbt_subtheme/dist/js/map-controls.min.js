!function(){function e(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,a,r,i,l=[],c=!0,s=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(o=r.call(n)).done)&&(l.push(o.value),l.length!==t);c=!0);}catch(e){s=!0,a=e}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw a}}return l}}(e,n)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?t(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}!function(t,n){n.behaviors.mapControls={attach:function(e,n){var o=this;"undefined"!=typeof L&&L.Map&&L.Map.addInitHook((function(){var e,n=this;"comparison-map"==(null===(e=this.options)||void 0===e?void 0:e.mapName)?o.bindLayerControls(this,"comparison-map"):(o.bindLayerControls(this,"main-map"),o.bindZoomControls(this),o.bindLocateControl(this),this.removeControl(this.zoomControl)),t(".map-controls__map-layer").each((function(){var e=t(this),n=e.attr("aria-label");e.select2({minimumResultsForSearch:1/0,placeholder:function(){return t(this).data("placeholder")},allowClear:!0});var o=e.next(".select2-container").find(".select2-selection__rendered");o.attr({role:"combobox","aria-label":n,"aria-haspopup":"listbox","aria-expanded":"false"}),e.on("select2:open",(function(){o.attr("aria-expanded","true")})).on("select2:close",(function(){o.attr("aria-expanded","false")})),e.on("select2:select",(function(e){var t=e.params.data.text;o.attr("aria-label","".concat(n,": ").concat(t))}))})),t(".map-controls__map-layer").val("default").trigger("change.select2"),this.on("unload",(function(){var e;"comparison-map"==(null===(e=this.options)||void 0===e?void 0:e.mapName)?o.unBindLayerControls("comparison-map"):o.unBindLayerControls("main-map")})),n.on("layeradd",(function(e){if(e.layer instanceof L.Marker){var t,o=e.layer.getElement();if(o)o.setAttribute("tabindex","0"),o.setAttribute("aria-label",(null===(t=e.layer.getPopup())||void 0===t?void 0:t.getContent())||"Map marker"),o.addEventListener("focus",(function(){var t=e.layer;if(t){var o=n.latLngToContainerPoint(t.getLatLng()),a=n.getSize(),r=100;(o.x<r||o.x>a.x-r||o.y<r||o.y>a.y-r)&&n.setView(t.getLatLng(),n.getZoom(),{animate:!0,duration:.5,padding:[50,50]})}})),o.addEventListener("keydown",(function(t){"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e.layer.openPopup())}))}})),n.on("layeradd",(function(e){if(e.layer instanceof L.MarkerClusterGroup){var t=e.layer;new MutationObserver((function(e){e.forEach((function(e){e.addedNodes&&e.addedNodes.forEach((function(e){if(e.classList&&e.classList.contains("marker-cluster")){var o;e.setAttribute("tabindex","0");var a=(null===(o=e.querySelector(".marker-cluster-count"))||void 0===o?void 0:o.textContent)||"0";e.setAttribute("aria-label","Cluster of "+a+" markers"),e.addEventListener("keydown",(function(o){if("Enter"===o.key||" "===o.key){o.preventDefault();var a=e.getBoundingClientRect(),r=n.getContainer().getBoundingClientRect(),i=n.containerPointToLatLng([a.left-r.left+a.width/2,a.top-r.top+a.height/2]),l=t.getLayers(),c=null,s=1/0;if(l.forEach((function(e){if(e instanceof L.MarkerCluster){var t=n.latLngToContainerPoint(e.getLatLng()),o=n.latLngToContainerPoint(i),a=Math.sqrt(Math.pow(t.x-o.x,2)+Math.pow(t.y-o.y,2));a<s&&(s=a,c=e)}})),c&&s<100){var u=c.getAllChildMarkers();if(u.length>0){var d=L.latLngBounds(u.map((function(e){return e.getLatLng()})));n.fitBounds(d,{padding:[50,50],animate:!0,duration:.5}),setTimeout((function(){var e=u[0].getElement();e&&e.focus()}),600)}}}}))}}))}))})).observe(n.getContainer(),{childList:!0,subtree:!0})}})),n.on("popupopen",(function(e){var t=e.popup.getElement();if(t){t.setAttribute("tabindex","0");var o=t.querySelector('.content-card__link, a, button, [tabindex="0"]');o?(o.setAttribute("tabindex","0"),o.focus()):t.focus();var a=n.latLngToContainerPoint(e.popup.getLatLng()),r=n.getSize(),i=100;(a.x<i||a.x>r.x-i||a.y<i||a.y>r.y-i)&&n.setView(e.popup.getLatLng(),n.getZoom(),{animate:!0,duration:.5,padding:[50,50]})}})),n.on("popupclose",(function(e){var t=e.popup._source;if(t){var n=t.getElement();n&&n.focus()}})),n.on("keydown",(function(e){if("Tab"===e.key){var t=Array.from(n.getLayers()).filter((function(e){return e instanceof L.Marker})).map((function(e){return e.getElement()})).filter((function(e){return e})),o=t.indexOf(document.activeElement);if(o>-1){e.preventDefault();var a=e.shiftKey?o-1:o+1;t[a>=t.length?0:a<0?t.length-1:a].focus()}}}));var a=function(e){if("Escape"===e.key)if(document.querySelector(".leaflet-popup"))e.preventDefault(),n.closePopup();else if(n.getContainer().contains(document.activeElement)){e.preventDefault();var t=document.querySelector(".paragraph-content");t&&(-1===t.tabIndex&&(t.tabIndex=0),t.focus())}};document.addEventListener("keydown",a),this.on("unload",(function(){document.removeEventListener("keydown",a)}))}))},bindLayerControls:function(e,n){var o=this,a=t(".map-controls__map-layer.".concat(n));a.change((function(n){var r=t(n.target).find(":selected").not("[map-layer-title='default']").data("map-layer-title");mapApiEndpoints=t(n.target).find(":selected").not("[map-layer-title='default']").data("map-api-endpoints"),o.handleLayerSelection(e,r,mapApiEndpoints),a.not(n.target).val("default").trigger("change.select2")})),a.on("select2:clear",(function(t){o.removeOtherMapLayers(e,null)}))},unBindLayerControls:function(e){t(".map-controls__map-layer.".concat(e)).off("click")},toggleLayerSelectorVisibility:function(e){var n=t(".map-controls__map-layer.".concat(e));n.is(".open")?n.removeClass("open"):n.addClass("open")},handleLayerSelection:function(e,t,n){var o=this;"present"!=t?n&&n.forEach((function(n){o.addMapLayer(e,n,t)})):o.removeOtherMapLayers(e,null)},addMapLayer:function(e,t,n){var o=this,a=o.getMapApiUrl(t.map_api);o.showLoadingSpinner();var r=L.tileLayer.wms(a,{layers:t.wms_title,format:"image/png",transparent:!0,className:n});r.addTo(e),r.on("load",(function(t){o.removeOtherMapLayers(e,n),o.hideLoadingSpinner()}))},removeOtherMapLayers:function(t,n){var o,a=Object.entries(t._layers).filter((function(t){var n,o=e(t,2);o[0];return null===(n=o[1].wmsParams)||void 0===n?void 0:n.layers}));(o=n?a.filter((function(t){var o=e(t,2);o[0];return o[1].options.className!==n})):a).length&&o.forEach((function(e){return e[1].remove()}))},getMapApiUrl:function(e){switch(e){case"kartta_hel_fi":return"https://kartta.hel.fi/ws/geoserver/avoindata/wms";case"geoserver_hel_fi":return"https://geoserver.hel.fi/geoserver/ows";default:return""}},showLoadingSpinner:function(){t("#map-loading-overlay").fadeIn(150)},hideLoadingSpinner:function(){t("#map-loading-overlay").fadeOut(150)},bindZoomControls:function(e){var n=t(".map-controls__control-button#zoom-in-btn"),o=t(".map-controls__control-button#zoom-out-btn");n.on("click",(function(){e.zoomIn()})),o.on("click",(function(){e.zoomOut()}))},bindLocateControl:function(e){var n=this;t(".map-controls__control-button#locate-btn").on("click",(function(){navigator.geolocation?(n.showLoadingSpinner(),navigator.geolocation.getCurrentPosition((function(t){n.hideLoadingSpinner();var o=t.coords.latitude,a=t.coords.longitude;n.addUserLocationMarker(o,a,e),e.panTo([o,a]),e.setZoom(15)}),(function(e){1===e.code&&n.showGeolocationDeniedBox(),n.hideLoadingSpinner()}))):console.log("Geolocation is not supported by your browser")}))},addUserLocationMarker:function(e,t,n){var o=new L.LatLng(e,t),a=L.icon({iconSize:["36","36"],iconUrl:"/themes/custom/hdbt_subtheme/src/icons/user.svg"});L.marker(o,{icon:a}).addTo(n)},showGeolocationDeniedBox:function(){var e=this,o=n.t("Location data blocked",{},{context:"Map selectors"}),a=n.t("Unfortunately, we are unable to show places on the map based on your location until you agree to use your location.",{},{context:"Map selectors"}),r=n.t("Close",{},{context:"Map selectors"});t(".leaflet-container").prepend('\n        <div id="geolocation-denied-overlay" style="display:none;">\n          <div class="info-box">\n            <div class="info-header">\n              <span class="info-icon"></span>\n              <h3>'.concat(o,'</h3>\n              <div class="close-btn" role="button">').concat(r,"</div>\n            </div>\n            <p>").concat(a,"</p>\n          </div>\n        </div>\n      ")),t("#geolocation-denied-overlay").fadeIn(150),t("#geolocation-denied-overlay .close-btn").on("click",(function(){e.hideGeoloactionDeniedBox()})),t(document).keyup((function(t){27===t.keyCode&&e.hideGeoloactionDeniedBox()}))},hideGeoloactionDeniedBox:function(){t("#geolocation-denied-overlay").fadeOut(150)}}}(jQuery,Drupal,drupalSettings)}();